# 🎤 机器人语音控制系统

这是一个为你的机器人小车添加的语音控制功能，支持通过中文语音命令控制机器人移动。

## 🎯 功能特点

- **中文语音识别**：支持多种中文语音命令
- **离线识别**：使用CMU Sphinx引擎，无需联网
- **Web界面集成**：语音控制与现有Web控制完美结合
- **实时响应**：语音命令立即执行，响应迅速
- **多种控制方式**：支持触屏摇杆、按钮和语音三种控制方式

## 📋 系统要求

- 树莓派 3B+ 或更高版本
- USB麦克风
- Python 3.7+
- 8GB以上存储空间

## 🔧 安装步骤

### 1. 安装系统依赖

```bash
cd src
chmod +x install_voice_dependencies.sh
./install_voice_dependencies.sh
```

### 2. 安装Python依赖

```bash
pip3 install -r requirements.txt
```

### 3. 连接USB麦克风

将USB麦克风连接到树莓派，然后检查是否识别：

```bash
arecord -l
```

应该能看到你的USB麦克风设备。

## 🚀 使用方法

### 启动语音控制系统

有两种启动方式：

#### 方式1：完整Web控制系统（推荐）
```bash
python3 robot_voice_web_control.py
```

然后在浏览器中访问：`http://你的树莓派IP:5000`

#### 方式2：纯语音控制
```bash
python3 voice_control.py
```

### Web界面操作

1. 打开浏览器，访问机器人的Web界面
2. 在语音控制面板中，点击"启动语音控制"按钮
3. 按钮变为红色闪烁状态表示正在监听
4. 对着麦克风说出语音命令

## 🗣️ 支持的语音命令

### 移动命令
- **向前移动**：`向前`、`前进`、`往前`、`前`
- **向后移动**：`向后`、`后退`、`往后`、`后`
- **左转**：`左转`、`向左`、`往左`、`左`
- **右转**：`右转`、`向右`、`往右`、`右`

### 侧移命令
- **左侧移动**：`左移`、`向左移动`
- **右侧移动**：`右移`、`向右移动`

### 控制命令
- **停止**：`停止`、`停`、`暂停`
- **加速**：`快一点`、`快点`、`加速`
- **减速**：`慢一点`、`慢点`、`减速`

## ⚙️ 配置选项

### 调整语音识别灵敏度

在`voice_control.py`中可以调整以下参数：

```python
# 在 listen_continuously 方法中
self.recognizer.energy_threshold = 300  # 能量阈值，越小越灵敏
self.recognizer.pause_threshold = 0.8   # 暂停阈值
```

### 修改默认设置

```python
# 在 VoiceController 类的 __init__ 方法中
self.default_speed = 50         # 默认速度 (0-100)
self.command_duration = 1.0     # 命令持续时间（秒）
```

### 添加新的语音命令

在`voice_control.py`的`command_mapping`字典中添加：

```python
self.command_mapping = {
    # 现有命令...
    '你的新命令': 'robot_command_name',
}
```

## 🔧 故障排除

### 麦克风问题

**问题**: 系统检测不到麦克风
```bash
# 重新加载USB音频模块
sudo modprobe -r snd-usb-audio
sudo modprobe snd-usb-audio

# 检查USB设备
lsusb
```

**问题**: 麦克风权限不足
```bash
# 将用户添加到audio组
sudo usermod -a -G audio $USER
# 重新登录或重启
```

### 语音识别问题

**问题**: 识别率低
- 确保在安静环境中使用
- 靠近麦克风说话（5-15cm距离）
- 说话清晰，速度适中
- 避免背景噪音

**问题**: 无法识别中文
- 确保pocketsphinx正确安装
- 检查语言包是否完整

### 系统性能问题

**问题**: 语音识别延迟高
- 降低语音识别频率
- 减少其他系统负载
- 使用更快的SD卡

## 📊 日志和调试

### 查看语音识别日志

语音控制系统会输出详细的日志信息：

```bash
# 启动时会显示
2024-01-01 12:00:00 - INFO - 检测到的麦克风设备: ['USB Audio Device']
2024-01-01 12:00:01 - INFO - 麦克风初始化完成
2024-01-01 12:00:02 - INFO - 语音控制系统已启动
2024-01-01 12:00:05 - INFO - 识别到语音: '向前'
2024-01-01 12:00:05 - INFO - 执行命令: forward
```

### 测试麦克风

```bash
# 录制3秒音频并播放
arecord -d 3 test.wav && aplay test.wav

# 检查音频设备
cat /proc/asound/cards
```

## 🎮 使用技巧

1. **清晰发音**: 语音命令要发音清晰，避免连读
2. **适当距离**: 保持与麦克风5-15cm的距离
3. **环境安静**: 在相对安静的环境中使用效果更好
4. **命令简短**: 使用简短的命令词，如"前"、"后"、"左"、"右"
5. **等待响应**: 发出命令后稍等片刻再发下一个命令

## 🔄 系统集成

语音控制系统与现有功能完全兼容：

- ✅ **Web控制界面**：可以同时使用Web按钮和语音控制
- ✅ **自动避障**：语音控制时避障系统仍然工作
- ✅ **摄像头监控**：视频流不受影响
- ✅ **传感器监控**：所有传感器数据正常显示

## 📞 技术支持

如果遇到问题，请检查：

1. USB麦克风是否正确连接和识别
2. 系统依赖是否完整安装
3. Python库是否正确安装
4. 音频权限是否配置正确

## 🔮 未来规划

- [ ] 支持更多语音命令
- [ ] 添加语音反馈功能
- [ ] 支持自定义唤醒词
- [ ] 改进中文识别准确度
- [ ] 添加语音控制的可视化界面

---

享受你的语音控制机器人吧！🤖✨ 