# AI桌宠用户使用指南

## 🎯 欢迎使用AI桌宠系统

这是一个基于树莓派的智能AI语音桌宠，具备自然对话、情感表达、个性化运动和记忆功能。本指南将帮助您快速上手并充分利用所有功能。

## 📋 目录

1. [快速开始](#快速开始)
2. [基础功能](#基础功能)
3. [AI对话功能](#ai对话功能)
4. [语音控制](#语音控制)
5. [情感表达系统](#情感表达系统)
6. [个性化设置](#个性化设置)
7. [记忆系统](#记忆系统)
8. [Web界面使用](#web界面使用)
9. [高级功能](#高级功能)
10. [故障排除](#故障排除)

## 🚀 快速开始

### 首次启动

1. **确保系统已安装**
   ```bash
   # 如果还未安装，运行安装脚本
   ./install_ai_desktop_pet.sh
   ```

2. **配置API密钥**
   ```bash
   # 编辑环境变量文件
   nano ~/.ai_pet_env
   
   # 填入你的Gemini API密钥
   export GEMINI_API_KEY="your_actual_api_key_here"
   
   # 加载环境变量
   source ~/.ai_pet_env
   ```

3. **启动系统**
   ```bash
   # 进入源码目录
   cd src
   
   # 启动AI桌宠系统
   python3 robot_voice_web_control.py
   ```

4. **访问Web界面**
   - 在浏览器中打开：`http://你的树莓派IP:5000`
   - 或在树莓派本地访问：`http://localhost:5000`

### 硬件连接检查

确保以下硬件正确连接：
- ✅ USB麦克风
- ✅ 音频输出设备（扬声器/耳机）
- ✅ OLED显示屏（I2C连接）
- ✅ 摄像头（PiCamera或USB摄像头）
- ✅ 机器人运动硬件（电机、传感器）

## 🎮 基础功能

### 运动控制

您的AI桌宠支持多种运动模式：

**基础运动**：
- 前进/后退
- 左转/右转
- 左右平移
- 原地旋转

**控制方式**：
1. **Web界面按钮**：点击方向按钮控制
2. **虚拟摇杆**：拖拽摇杆控制方向
3. **语音命令**：说出"向前"、"左转"等命令
4. **AI对话**：在对话中提及运动指令

### 传感器功能

**自动避障**：
- 红外传感器检测侧面障碍物
- 超声波传感器检测前方距离
- 遇到障碍物自动后退和转向

**摄像头监控**：
- 实时视频流显示
- 支持PiCamera和USB摄像头
- 可在Web界面查看第一视角画面

## 🤖 AI对话功能

### 启动对话模式

1. **通过Web界面**：
   - 点击"启动AI对话"按钮
   - 按钮变为绿色表示对话模式已激活

2. **通过语音唤醒**：
   - 说出唤醒词："喵喵小车"
   - 听到确认音后开始对话

### 对话交互

**基本对话**：
```
用户: "你好，你叫什么名字？"
桌宠: "你好！我是圆滚滚，你的AI桌宠伙伴~"
```

**运动指令对话**：
```
用户: "我们去那边看看吧"
桌宠: "好的！我们一起去探索~" (同时执行前进动作)
```

**情感交互**：
```
用户: "今天天气真好！"
桌宠: "是啊！我也很开心~" (显示开心表情，执行庆祝动作)
```

### 对话技巧

- **清晰发音**：确保发音清晰，语速适中
- **适当距离**：与麦克风保持10-20cm距离
- **安静环境**：在相对安静的环境中使用效果更好
- **自然交流**：像与朋友聊天一样自然交流

## 🎤 语音控制

### 支持的语音命令

**运动命令**：
- "向前" / "前进" / "往前"
- "向后" / "后退" / "往后"
- "左转" / "向左" / "往左"
- "右转" / "向右" / "往右"
- "左移" / "右移"
- "转圈" / "旋转"

**控制命令**：
- "停止" / "停"
- "快一点" / "加速"
- "慢一点" / "减速"

**系统命令**：
- "喵喵小车"（唤醒词）
- "开始对话"
- "结束对话"

### 语音识别设置

**调整识别灵敏度**：
```python
# 在配置文件中调整
{
    "voice_settings": {
        "energy_threshold": 300,  # 降低数值提高灵敏度
        "pause_threshold": 0.8,   # 调整暂停检测时间
        "timeout": 1.0           # 调整超时时间
    }
}
```

## 😊 情感表达系统

### 情感类型

您的AI桌宠能表达以下情感：

**开心（Happy）**：
- 表情：笑脸眼睛
- 动作：快速旋转、弹跳动作
- 触发：正面对话、赞美、成功完成任务

**兴奋（Excited）**：
- 表情：大眼睛、闪烁效果
- 动作：快速移动、摆动
- 触发：新发现、有趣话题

**困惑（Confused）**：
- 表情：疑问眼神
- 动作：头部倾斜、缓慢移动
- 触发：不理解的指令、复杂问题

**思考（Thinking）**：
- 表情：沉思表情、移动点
- 动作：轻微摆动
- 触发：处理复杂问题、等待AI回复

**悲伤（Sad）**：
- 表情：下垂眼睛
- 动作：缓慢移动、低头
- 触发：负面话题、错误操作

### 情感触发机制

情感由以下因素触发：
1. **AI回复内容分析**：分析回复文本的情感倾向
2. **用户语调识别**：识别用户说话的情感色彩
3. **对话上下文**：根据对话历史判断情感状态
4. **交互结果**：根据操作成功与否调整情感

## ⚙️ 个性化设置

### 基础个性设置

**修改机器人名字**：
```python
# 通过Web界面或配置文件
{
    "personality": {
        "name": "你想要的名字",
        "user_name": "你的名字"
    }
}
```

**调整性格特征**：
- **友好度** (0-1)：影响回复的友善程度
- **活跃度** (0-1)：影响运动的频率和强度
- **好奇心** (0-1)：影响对新事物的反应
- **顽皮度** (0-1)：影响行为的活泼程度

### 语音个性化

**更换TTS语音**：
```json
{
    "voice_preferences": {
        "voice": "zh-CN-XiaoxiaoNeural",  // 女声
        "rate": "+10%",                   // 语速
        "volume": "+0%"                   // 音量
    }
}
```

**可选语音**：
- `zh-CN-XiaoxiaoNeural`：温柔女声
- `zh-CN-YunxiNeural`：活泼男声
- `zh-CN-YunjianNeural`：成熟男声
- `zh-CN-XiaoyiNeural`：甜美女声

### 运动个性化

**运动风格设置**：
```json
{
    "behavior_preferences": {
        "movement_style": "bouncy",      // 弹跳式
        "speed_preference": "medium",    // 中等速度
        "interaction_frequency": "high"  // 高互动频率
    }
}
```

## 🧠 记忆系统

### 对话记忆

您的AI桌宠会记住：
- **对话历史**：最近的对话内容
- **个人信息**：您告诉它的关于您的信息
- **偏好设置**：您表达的喜好和偏好
- **交互模式**：您习惯的交互方式

### 记忆功能示例

**个人信息记忆**：
```
用户: "我叫小明，我喜欢听音乐"
桌宠: "好的小明，我记住了你喜欢音乐！"

# 下次对话
用户: "你还记得我的名字吗？"
桌宠: "当然记得！你是小明，而且你喜欢听音乐对吧？"
```

**偏好学习**：
```
用户: "慢一点"
桌宠: "好的，我记住你喜欢慢一点的速度"
# 系统自动调整默认速度偏好
```

### 记忆管理

**查看记忆内容**：
- 通过Web界面查看对话历史
- 查看学习到的用户偏好
- 查看个性化设置

**清理记忆**：
```bash
# 清理对话历史
python3 -c "from memory_manager import MemoryManager; MemoryManager().cleanup_old_data(days=30)"

# 重置所有记忆
python3 -c "from memory_manager import MemoryManager; MemoryManager().reset_all_data()"
```

## 🌐 Web界面使用

### 主界面功能

**控制面板**：
- 运动控制按钮（九宫格布局）
- 虚拟摇杆控制
- 速度调节滑块
- 功能开关（避障、语音控制、AI对话）

**状态显示**：
- 实时视频流
- 传感器数据显示
- 当前情感状态
- 电池电量（如果支持）

**AI对话面板**：
- 对话历史显示
- 当前情感状态指示器
- 语音识别状态
- 个性设置控制

### 移动设备优化

**触屏操作**：
- 虚拟摇杆支持触摸拖拽
- 按钮大小适配手指操作
- 响应式布局适配不同屏幕

**手势控制**：
- 滑动控制方向
- 双击快速停止
- 长按进入语音模式

## 🔧 高级功能

### 自定义唤醒词

1. **注册Picovoice账号**：
   - 访问：https://console.picovoice.ai/
   - 获取访问密钥

2. **训练自定义唤醒词**：
   - 在Picovoice控制台创建唤醒词
   - 下载.ppn文件

3. **配置使用**：
   ```bash
   export PICOVOICE_ACCESS_KEY="your_key"
   # 将.ppn文件放入项目目录
   ```

### 插件扩展

**自定义动作序列**：
```python
# 在personality_manager.py中添加
def custom_dance_sequence(self):
    """自定义舞蹈序列"""
    self.robot.turnLeft(0.5)
    time.sleep(0.5)
    self.robot.turnRight(0.5)
    time.sleep(0.5)
    self.robot.t_up(1.0)
```

**自定义情感表达**：
```python
# 在expression_controller.py中添加
def show_custom_emotion(self, emotion_name):
    """自定义情感表达"""
    # 实现自定义表情动画
    pass
```

### 系统服务管理

**启用自动启动**：
```bash
sudo systemctl enable ai-desktop-pet
sudo systemctl start ai-desktop-pet
```

**查看服务状态**：
```bash
sudo systemctl status ai-desktop-pet
```

**查看日志**：
```bash
journalctl -u ai-desktop-pet -f
```

## 🔍 故障排除

### 常见问题

**1. AI对话不工作**
- 检查Gemini API密钥是否正确配置
- 确认网络连接正常
- 查看日志中的错误信息

**2. 语音识别失败**
- 检查USB麦克风连接
- 调整麦克风音量和位置
- 确认在安静环境中使用

**3. 语音合成无声音**
- 检查音频输出设备
- 确认音量设置
- 测试系统音频：`speaker-test`

**4. 运动控制不响应**
- 检查硬件连接
- 确认GPIO权限
- 查看传感器状态

**5. OLED显示不工作**
- 检查I2C连接
- 确认I2C已启用：`sudo raspi-config`
- 测试I2C设备：`i2cdetect -y 1`

### 日志分析

**查看系统日志**：
```bash
# 查看AI桌宠服务日志
journalctl -u ai-desktop-pet -n 50

# 查看Python错误日志
tail -f src/data/logs/error.log

# 查看对话日志
tail -f src/data/logs/conversation.log
```

**调试模式运行**：
```bash
cd src
python3 robot_voice_web_control.py --debug
```

### 性能优化

**内存优化**：
```bash
# 清理系统缓存
sudo sync
sudo sh -c 'echo 3 > /proc/sys/vm/drop_caches'

# 限制对话历史长度
python3 -c "from config import config_manager; config_manager.update_ai_settings(max_history_length=50)"
```

**网络优化**：
```bash
# 使用本地Whisper模型
python3 -c "import whisper; whisper.load_model('tiny')"
```

## 📞 获取帮助

### 文档资源

- **API文档**：`API_DOCUMENTATION.md`
- **故障排除指南**：`TROUBLESHOOTING_GUIDE.md`
- **维护文档**：`MAINTENANCE_GUIDE.md`

### 社区支持

- **GitHub Issues**：报告问题和建议
- **用户论坛**：与其他用户交流经验
- **开发者文档**：了解系统架构和扩展方法

### 联系方式

- **技术支持**：查看故障排除指南
- **功能建议**：通过GitHub Issues提交
- **安全问题**：通过私有渠道报告

## 🎉 享受您的AI桌宠

恭喜您！现在您已经掌握了AI桌宠的所有功能。您的智能伙伴已经准备好与您进行自然对话、表达情感、记住您的偏好，并成为您的贴心桌面伙伴。

记住，AI桌宠会随着与您的交互不断学习和成长，变得越来越了解您的喜好和习惯。享受这个独特的AI伙伴带来的乐趣吧！

---

*最后更新：2024年1月*
*版本：1.0*