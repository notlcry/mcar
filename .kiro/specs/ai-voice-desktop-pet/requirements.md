# 需求文档

## 项目介绍

本项目旨在将现有的树莓派4B机器人控制系统升级为智能AI语音桌宠。当前系统已具备网页控制、实时视频流、避障功能和基础中文语音命令。此次升级将添加AI对话能力、情感表达、语音合成回复和个性化行为，打造一个能够自然交互的智能桌面伴侣，通过语音对话和动作表情展现个性。

## 需求列表

### 需求1：AI对话系统

**用户故事：** 作为用户，我希望能与我的桌宠机器人进行自然对话，让交互感觉像是在与智能伙伴聊天而不仅仅是发出指令。

#### 验收标准

1. 当用户说出唤醒词"喵喵小车"时，系统应激活对话模式并提供音频反馈
2. 当用户在唤醒后说话时，系统应使用Whisper.cpp将语音转换为文本
3. 当接收到语音识别文本时，系统应发送到ChatGPT API并获取回复
4. 当收到AI回复时，系统应使用edge-tts转换为语音并通过扬声器播放
5. 如果对话空闲超过30秒，系统应返回待机模式

### 需求2：情感表达系统

**用户故事：** 作为用户，我希望我的桌宠通过视觉表情和动作展现情感和个性，让交互更加生动有趣。

#### 验收标准

1. 当系统分析AI回复内容时，应确定情感状态（开心、难过、兴奋、困惑、生气）
2. 当确定情感状态时，系统应在OLED屏幕上显示相应动画
3. 当表达开心时，机器人应执行庆祝动作如旋转或摆动
4. 当表达难过或困惑时，机器人应缓慢移动或将摄像头向下倾斜
5. 当说话时，系统应在屏幕上显示"说话"动画和嘴部动作
6. 当空闲时，系统应显示眨眼或呼吸动画

### 需求3：个性化运动控制

**用户故事：** 作为用户，我希望我的桌宠根据对话内容和情感做出相应的移动和反应，表现得像一个有个性的活体伙伴。

#### 验收标准

1. 当用户说出移动指令如"我们走吧"时，机器人应前进并显示兴奋表情
2. 当用户要求机器人"转个圈"时，机器人应原地旋转并显示开心动画
3. 当AI判断应表达不同意时，机器人应后退并显示消极表情
4. 当对话话题令人兴奋时，机器人应使用更快、更生动的动作
5. 当机器人"思考"（等待AI回复）时，应显示沉思动画和轻柔摆动

### 需求4：增强语音交互

**用户故事：** 作为用户，我希望改进语音识别和自然语音合成，让对话感觉流畅自然。

#### 验收标准

1. 当系统启动时，应初始化Porcupine唤醒词检测"喵喵小车"
2. 当检测到唤醒词时，系统应在1秒内提供即时音频确认
3. 当处理语音时，系统应使用Whisper.cpp进行本地语音识别以减少延迟
4. 当生成语音时，系统应使用edge-tts配置友好的中文语音
5. 当说话时，系统应将嘴部动画与音频输出同步

### 需求5：视觉表情显示

**用户故事：** 作为用户，我希望在屏幕上看到我的桌宠的脸部和表情，以便理解它的情感状态并感到更亲近。

#### 验收标准

1. 当系统初始化时，应在OLED屏幕上显示默认的"清醒"眼睛
2. 当触发不同情感时，系统应显示相应的面部表情（开心眼睛、难过眼睛、惊讶眼睛等）
3. 当机器人说话时，系统应播放与TTS输出同步的嘴部动作动画
4. 当机器人聆听时，系统应显示专注的表情和聚焦的眼睛
5. 当系统处理（思考）时，应显示思考动画如移动的点或沉思表情

### 需求6：集成控制界面

**用户故事：** 作为用户，我希望通过现有的网页界面控制所有桌宠功能，方便管理其行为和设置。

#### 验收标准

1. 当访问网页界面时，用户应看到AI对话模式、个性设置和表情偏好的新控件
2. 当用户切换AI对话模式时，系统应启用/禁用完整的AI交互流程
3. 当用户调整个性设置时，机器人应相应修改其运动模式和回应风格
4. 当用户选择不同语音选项时，系统应更新TTS设置以使用不同角色语音
5. 当用户查看界面时，应能看到机器人当前的情感状态和对话状态

### 需求7：记忆和上下文管理

**用户故事：** 作为用户，我希望我的桌宠能记住我们的对话和偏好，让交互随时间变得更加个性化。

#### 验收标准

1. 当发生对话时，系统应存储当前会话的对话上下文
2. 当用户提及偏好时，系统应记住它们以供未来交互使用
3. 当用户询问之前的话题时，系统应引用早期对话内容
4. 当系统重启时，应加载基本个性设置和用户偏好
5. 如果对话历史超过内存限制，系统应总结并保留关键信息

### 需求8：安全和备用机制

**用户故事：** 作为用户，我希望我的桌宠能安全运行，并在网络或AI服务不可用时具备备用功能，确保它保持功能性且不会造成任何伤害。

#### 验收标准

1. 当网络连接丢失时，系统应回退到离线语音命令和预编程回复
2. 当AI API调用失败时，系统应提供友好的错误消息并建议重试
3. 当机器人移动时，现有的避障系统应保持活跃并优先于个性化动作
4. 当电池电量低时，系统应减少移动频率并显示低电量表情
5. 当系统资源受限时，系统应优先考虑核心安全功能而非个性化特性